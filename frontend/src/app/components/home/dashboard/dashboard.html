@if (isLoading()) {
<div class="loading-container">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">{{'Cargando...' | transloco}}</span>
  </div>
  <p class="loading-text">{{'Cargando tickets recientes...' | transloco}}</p>
</div>
} @else {
<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="header-content">
      <div class="welcome-info">
        <h1 class="welcome-title">
          <i class="bi bi-house-door"></i> {{'Bienvenido' | transloco}}, {{ fullName() }}
        </h1>
        <p class="welcome-subtitle">{{'Tus tickets más recientes' | transloco}}</p>
      </div>
    </div>
  </div>

  <div class="main-content-grid">
    <div class="recent-tickets-section">
      <div class="card recent-tickets-card">
        <div class="card-header">
          <div class="card-header-content">
            <h2 class="card-title">
              <i class="bi bi-clock-history"></i>
              {{'Tickets Recientes' | transloco}}
            </h2>
            <div class="header-actions">
              <button class="btn btn-refresh" (click)="refreshData()" [disabled]="isLoading()">
                <i class="bi" [ngClass]="isLoading() ? 'bi-arrow-clockwise spin' : 'bi-arrow-clockwise'"></i>
                {{ isLoading() ? ('Actualizando...' | transloco) : ('Actualizar' | transloco) }}
              </button>
            </div>
          </div>
        </div>

        <div class="card-body">
          @if (recentTickets().length === 0) {
          <div class="empty-state">
            <div class="empty-content">
              <i class="bi bi-inbox empty-icon"></i>
              <h3>{{'No hay tickets recientes.' | transloco}}</h3>
              <p>{{'No se encontraron tickets en el sistema.' | transloco}}</p>
              <button class="btn btn-primary" (click)="nuevoTicket()">
                <i class="bi bi-plus-circle"></i>
                {{'Crear Primer Ticket' | transloco}}
              </button>
            </div>
          </div>
          } @else {
          <div class="table-responsive">
            <table class="tickets-table">
              <thead class="table-header">
                <tr>
                  <th class="ticket-col">Ticket</th>
                  <th class="subject-col">Asunto</th>
                  <th class="status-col">Estado</th>
                  <th class="priority-col">Prioridad</th>
                  <th class="date-col">Fecha</th>
                </tr>
              </thead>
              <tbody>
                @for (ticket of recentTickets(); track ticket.id) {
                <tr class="table-row">
                  <td class="ticket-col">
                    <div class="ticket-code">{{ ticket.consecutivo }}</div>
                  </td>

                  <td class="subject-col">
                    <div class="ticket-info">
                      <div class="ticket-title">{{ ticket.titulo }}</div>
                      <div class="ticket-category">
                        <i class="bi bi-tag"></i>
                        {{ ticket.categoria?.nombre || 'Sin categoría' }}
                      </div>
                    </div>
                  </td>

                  <td class="status-col">
                    <span class="badge" [ngClass]="getEstadoBadgeClass(ticket.estado)">
                      <i class="bi me-1" [ngClass]="getEstadoIcon(ticket.estado)"></i>
                      {{ getEstadoText(ticket.estado) }}
                    </span>
                  </td>

                  <td class="priority-col">
                    <span class="badge" [ngClass]="getPrioridadBadgeClass(ticket.prioridad)">
                      <i class="bi me-1" [ngClass]="getPriorityIcon(ticket.prioridad)"></i>
                      {{ ticket.prioridad }}
                    </span>
                  </td>

                  <td class="date-col">
                    <div class="ticket-date">
                      <div class="date-day">{{ ticket.fechaCreacion | date:'dd/MM/yyyy' }}</div>
                    </div>
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>

          <div class="table-footer">
            <div class="table-stats">
              {{'Mostrando' | transloco}} {{ recentTickets().length }} {{'tickets más recientes' | transloco}}

            </div>
            <button class="btn btn-outline" routerLink="/historial">
              <i class="bi bi-clock-history"></i>
              {{'Ver Todos los Tickets' | transloco}}
            </button>
          </div>
          }
        </div>
      </div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-content">
        <div class="card activity-card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="bi bi-activity"></i> {{'Actividad Reciente' | transloco}}
            </h5>
          </div>
          <div class="card-body">
            <div class="activity-list">
              @for (activity of recentActivity(); track activity.text) {
              <div class="activity-item">
                <div class="activity-icon" [ngClass]="'bg-' + activity.color">
                  <i class="bi" [class]="activity.icon"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-text">{{ activity.text | transloco}}</div>
                  <div class="activity-time">{{ activity.time | transloco}}</div>
                </div>
              </div>
              }

              @if (recentActivity().length === 0) {
              <div class="empty-activity">
                <i class="bi bi-activity text-muted"></i>
                <p class="text-muted">{{'No hay actividad reciente' | transloco}}</p>
              </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
}